#!/usr/bin/env python

import argparse
import sys

from unidiff import PatchSet


def get_parser():
    parser = argparse.ArgumentParser(description='Unified diff metadata')
    parser.add_argument('--show-diff', action="store_true", default=False,
                        dest='show_diff')
    parser.add_argument('-f', '--file', dest='diff_file', type=file)
    return parser


if __name__ == '__main__':
    parser = get_parser()
    args = parser.parse_args()

    if args.diff_file:
        diff_file = args.diff_file
    else:
        diff_file = sys.stdin

    patch = PatchSet(diff_file)
    if args.show_diff:
        for i in patch.as_unified_diff():
            print i

    additions = 0
    deletions = 0
    for f in patch:
        additions += f.added
        deletions += f.removed
        print '%s:' % f.path, '+%d additions,' % f.added, '-%d deletions' % f.removed

    print
    print '%d modified file(s), %d added file(s), %d removed file(s)' % (
        len(patch.modified_files), len(patch.added_files), len(patch.removed_files))
    print 'Total: %d addition(s), %d deletion(s)' % (additions, deletions)
