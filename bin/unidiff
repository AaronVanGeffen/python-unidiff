#!/usr/bin/env python

import argparse
import sys

from unidiff import parse_unidiff


def get_parser():
    parser = argparse.ArgumentParser(description='Unified diff metadata')
    parser.add_argument('--show-diff', action="store_true", default=False,
                        dest='show_diff')
    parser.add_argument('-f', '--file', dest='diff_file', type=file)
    return parser


if __name__ == '__main__':
    parser = get_parser()
    args = parser.parse_args()

    if args.diff_file:
        diff_file = args.diff_file
        # close file
    else:
        diff_file = sys.stdin

    #print diff_file
    #print args.show_diff
    res = parse_unidiff(diff_file)
    if args.show_diff:
        for i in res.as_unified_diff():
            print i

    for f in res:
        print f.path, '+%d' % f.added, '-%d' % f.removed

    #print res
    #(show diff? metadata only?)
    #try:
        #metadata = PatchSet.from_file()
    #except UnidiffParseError:
        #print 'Error'
        #sys.exit(1)

    #print added_files (+ lines)
    #print removed_files (- lines)
    #print modified_files (for each, +/-)
